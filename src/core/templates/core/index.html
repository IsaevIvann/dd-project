{% extends "core/base.html" %}
{% block title %}D&D — Путешествуйте налегке{% endblock %}
{% block content %}
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
  :root{--ink:#0f172a;--muted:#64748b;--r:24px;}
  body{font-family:'Poppins',system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;}
  h1,h2,h3,h4{letter-spacing:-0.01em;}
  .pill{border-radius:999px}
  .card-dd{border:0;border-radius:var(--r);box-shadow:0 12px 30px rgba(16,24,40,.08);background:#fff;}
  .hero-clean{border-radius:32px;padding:3.5rem 2rem;background:#fff;box-shadow:0 20px 50px rgba(16,24,40,.06)}
  .hero-ill{border-radius:24px;background:#fff;box-shadow:0 10px 26px rgba(16,24,40,.08)}
  .icon-wrap{width:68px;height:68px;border-radius:18px;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 20px rgba(16,24,40,.06)}
  .icon-blue{background:#e6f0ff;color:#2563eb;}
  .icon-green{background:#e9fff4;color:#0e9f6e;}
  .icon-cyan{background:#e6fcff;color:#0891b2;}
  .icon-amber{background:#fff5e6;color:#f59e0b;}
  .tariff-title{color:var(--muted);}
  .tariff-price{font-size:1.6rem;font-weight:400;line-height:1.3;color:var(--ink);letter-spacing:normal}
  .tariff-price .rub{font-weight:300}
  .tariff-price .period{font-weight:400}
  .tariff-note{color:var(--muted);}
</style>

<section class="hero-clean mb-5">
  <div class="row align-items-center gy-4">
    <div class="col-lg-7">
      <h1 class="fw-bold display-5 mb-3" style="color:var(--ink)">
        Путешествуйте <span class="text-primary">налегке</span> — мы заберём, сохраним и доставим багаж
      </h1>
      <p class="fs-5 text-muted mb-4">
        Представитель приедет, упакует и опечатает чемоданы. Мы сохраним их на складе и привезём
        <span class="fw-semibold">в удобное для вас место</span>: аэропорт, вокзал или отель — точно в срок.
      </p>
      <div class="d-flex flex-wrap gap-3">
        <a href="{% url 'order_create' %}" class="btn btn-lg btn-primary pill px-4">
          <i class="bi bi-bag-check"></i> Оставить заявку
        </a>
        <a href="#tariffs" class="btn btn-lg btn-outline-primary pill px-4">
          <i class="bi bi-tags"></i> Тарифы
        </a>
      </div>
    </div>
    <div class="col-lg-5">
      <div class="hero-ill p-4">
        <svg viewBox="0 0 520 300" width="100%" height="100%" aria-hidden="true">
          <rect x="0" y="250" width="520" height="28" fill="#eef5ff"/>
          <rect x="70" y="220" width="340" height="12" rx="6" fill="#c7d8f9"/>
          <rect x="85" y="140" width="10" height="85" rx="5" fill="#c7d8f9"/>
          <rect x="380" y="140" width="10" height="85" rx="5" fill="#c7d8f9"/>
          <rect x="150" y="130" rx="18" ry="18" width="150" height="110" fill="#2a74e6"/>
          <rect x="200" y="90" width="24" height="50" rx="6" fill="#2a74e6"/>
          <circle cx="175" cy="248" r="10" fill="#123a6d"/>
          <circle cx="275" cy="248" r="10" fill="#123a6d"/>
          <rect x="320" y="150" rx="14" ry="14" width="110" height="90" fill="#ff8c65" opacity=".95"/>
          <rect x="355" y="132" rx="6" ry="6" width="44" height="22" fill="#ff8c65"/>
          <circle cx="335" cy="248" r="9" fill="#9a3e1f"/>
          <circle cx="415" cy="248" r="9" fill="#9a3e1f"/>
          <rect x="120" y="170" rx="12" ry="12" width="70" height="70" fill="#25a56a"/>
          <rect x="140" y="150" rx="5" ry="5" width="30" height="20" fill="#25a56a"/>
          <circle cx="135" cy="248" r="8" fill="#0c5a3d"/>
          <circle cx="175" cy="248" r="8" fill="#0c5a3d"/>
        </svg>
        <div class="small text-muted mt-2">Ваш багаж — под защитой и уже в пути ✈️</div>
      </div>
    </div>
  </div>
</section>

<section class="p-4 p-md-5 mb-5" style="border-radius:28px;background:#f7fbff">
  <h3 class="fw-bold text-center mb-4">Как это работает?</h3>
  <div class="row g-4">
    <div class="col-md-3 text-center">
      <div class="icon-wrap icon-blue mx-auto mb-3"><i class="bi bi-pencil-square fs-3"></i></div>
      <h6 class="mb-1">1. Заявка</h6>
      <div class="text-muted small">Оставляете на сайте или в мессенджере.</div>
    </div>
    <div class="col-md-3 text-center">
      <div class="icon-wrap icon-green mx-auto mb-3"><i class="bi bi-person-check fs-3"></i></div>
      <h6 class="mb-1">2. Встреча</h6>
      <div class="text-muted small">Приезжает представитель с документами и упаковкой.</div>
    </div>
    <div class="col-md-3 text-center">
      <div class="icon-wrap icon-cyan mx-auto mb-3"><i class="bi bi-lock fs-3"></i></div>
      <h6 class="mb-1">3. Опечатываем</h6>
      <div class="text-muted small">Пломбируем, фотографируем, выдаём квитанцию.</div>
    </div>
    <div class="col-md-3 text-center">
      <div class="icon-wrap icon-amber mx-auto mb-3"><i class="bi bi-geo-alt fs-3"></i></div>
      <h6 class="mb-1">4. Доставка</h6>
      <div class="text-muted small">Привозим по адресу, в аэропорт или на вокзал.</div>
    </div>
  </div>
</section>

<section id="tariffs" class="mb-5">
  <style>
    .dd-chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid #d6e4ff;background:#ecf3ff;color:#1e3a8a;font-size:12px}
    .dd-divider{height:1px;background:#eef2ff;margin:8px 0 10px}
    .dd-calc .form-control,.dd-calc .form-select{border-radius:12px;padding:.8rem .9rem;border-color:#e5e7eb}
    .dd-calc .form-control:focus,.dd-calc .form-select:focus{border-color:#2563eb;box-shadow:0 0 0 .35rem rgba(37,99,235,.15)}
    .dd-total{font-weight:800;font-size:1.6rem;color:var(--ink)}
    .dd-muted{color:var(--muted)}
  </style>

  <h3 class="fw-bold text-center mb-4">Тарифы</h3>

  <div class="row g-4">
    <div class="col-md-4">
      <div class="card-dd p-4 h-100 text-center">
        <div class="small tariff-title mb-1">1–3 единицы</div>
        <div class="tariff-price mb-2">от 2 500 <span class="rub">₽</span></div>
        <div class="dd-divider"></div>
        <div class="text-muted small">Забор → хранение → доставка</div>
        <div class="mt-2"><span class="dd-chip">1-е сутки хранения бесплатно</span></div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card-dd p-4 h-100 text-center">
        <div class="small tariff-title mb-1">4–6 единиц</div>
        <div class="tariff-price mb-2">от 3 000 <span class="rub">₽</span></div>
        <div class="dd-divider"></div>
        <div class="text-muted small">Все опции включены</div>
        <div class="mt-2"><span class="dd-chip">1-е сутки хранения бесплатно</span></div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card-dd p-4 h-100 text-center">
        <div class="small tariff-title mb-1">7+ единиц</div>
        <div class="tariff-price mb-2">3 000 <span class="rub">₽</span> + 500 ₽/за каждую доп. ед.</div>
        <div class="dd-divider"></div>
        <div class="text-muted small">Гибко и выгодно для групп</div>
        <div class="mt-2"><span class="dd-chip">1-е сутки хранения бесплатно</span></div>
      </div>
    </div>
  </div>

  <div class="card-dd p-4 p-md-4 mt-4 dd-calc">
    <h5 class="fw-bold mb-3">Калькулятор стоимости</h5>
    <form class="row g-3 align-items-end" onsubmit="event.preventDefault(); ddCalc();">
      <div class="col-6 col-md-3">
        <label class="form-label dd-muted">Количество единиц</label>
        <input id="dd-items" type="number" min="1" max="99" value="2" class="form-control" required>
      </div>
      <div class="col-6 col-md-3">
        <label class="form-label dd-muted">Дней хранения (включая 1‑е)</label>
        <input id="dd-days" type="number" min="1" max="30" value="1" class="form-control" required>
      </div>
      <div class="col-12 col-md-4">
        <label class="form-label dd-muted">Зона</label>
        <select id="dd-zone" class="form-select">
          <option value="1.0" selected>Зона 1 — Москва, все аэропорты (×1.0)</option>
          <option value="1.5">Зона 1.5 — Московская область (×1.5)</option>
        </select>
      </div>
      <div class="col-12 col-md-2">
        <button class="btn btn-primary w-100 pill" type="submit"><i class="bi bi-calculator"></i> Рассчитать</button>
      </div>
    </form>

    <div id="dd-result" class="mt-3" hidden>
      <div class="dd-total" id="dd-total">0 ₽</div>
      <div class="dd-muted small" id="dd-lines"></div>
    </div>
    <div class="dd-muted small mt-2">
      База умножается на коэффициент зоны. Хранение — единый тариф: 1‑е сутки бесплатно, далее 500 ₽/сутки за всю партию.
    </div>
  </div>

  <div id="zones" class="mt-4">
    <div class="row g-4 align-items-stretch">
      <div class="col-lg-6">
        <div class="card-dd p-4 h-100">
          <div class="small text-muted">Зона 1</div>
          <div class="h5 fw-bold mb-1">Москва, аэропорты и вокзалы</div>
          <div class="text-muted mb-3">Коэффициент: <span class="fw-semibold">×1.0</span></div>
          <div class="dd-divider"></div>
          <div class="small text-muted">Зона 1.5</div>
          <div class="h5 fw-bold mb-1">Московская область</div>
          <div class="text-muted">Коэффициент: <span class="fw-semibold">×1.5</span></div>
          <div class="small text-muted mt-3">Коэффициент применяется только к базовой услуге (забор + доставка). Хранение — по единому тарифу.</div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card-dd p-2 h-100 d-flex align-items-center justify-content-center" style="overflow:hidden">
          <div class="zone-hint">
            <div class="zone-hint__header">
              <span class="zone-hint__icon">🧭</span>
              <div>
                <div class="zone-hint__title">Не уверены, к какой зоне относится адрес?</div>
                <div class="zone-hint__subtitle">Укажите адрес — мы подскажем зону и применим нужный коэффициент автоматически.</div>
              </div>
            </div>

            <label class="zone-hint__label" for="zoneAddress">Адрес или место (например, «Внуково», «Одинцово»)</label>
            <div class="zone-hint__row">
              <input id="zoneAddress" class="zone-hint__input" type="text" placeholder="Введите адрес">
              <button id="detectZone" class="zone-hint__btn" type="button">Определить зону</button>
            </div>

            <div id="zoneResult" class="zone-hint__result" aria-live="polite"></div>

            <ul class="zone-hint__notes">
              <li><strong>Зона 1</strong> — Москва в пределах МКАД, все аэропорты и вокзалы.</li>
              <li><strong>Зона 1.5</strong> — Московская область (за МКАД).</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .zone-hint{background:#fff;border:1px solid rgba(15,23,42,.06);border-radius:var(--r,20px);padding:16px 16px 14px;box-shadow:0 1px 2px rgba(0,0,0,.03)}
  .zone-hint__header{display:flex;gap:12px;align-items:flex-start;margin-bottom:12px}
  .zone-hint__icon{font-size:20px;line-height:1}
  .zone-hint__title{font-weight:600;color:var(--ink,#0f172a)}
  .zone-hint__subtitle{font-size:13px;color:var(--muted,#64748b);margin-top:2px}
  .zone-hint__label{display:block;font-size:12px;color:var(--muted,#64748b);margin:8px 0 6px}
  .zone-hint__row{display:flex;gap:8px}
  .zone-hint__input{flex:1;border:1px solid rgba(15,23,42,.12);border-radius:12px;padding:10px 12px;font-size:14px;outline:none}
  .zone-hint__input:focus{border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,.15)}
  .zone-hint__btn{white-space:nowrap;border:none;border-radius:12px;padding:10px 14px;font-weight:600;background:#2563eb;color:#fff;cursor:pointer}
  .zone-hint__btn:hover{filter:brightness(.95)}
  .zone-hint__result{margin-top:10px;font-size:14px}
  .zone-hint__result .pill{display:inline-block;border-radius:999px;padding:4px 10px;font-weight:600}
  .pill--z1{background:rgba(34,197,94,.14);color:#166534}
  .pill--z15{background:rgba(234,179,8,.16);color:#92400e}
  .zone-hint__notes{margin:10px 0 0 16px;color:var(--muted,#64748b);font-size:12px}
</style>

<script>
  function ddCalc(){
    const items = Math.max(1, parseInt(document.getElementById('dd-items').value || '1', 10));
    const days  = Math.max(1, parseInt(document.getElementById('dd-days').value  || '1', 10));
    const zoneK = parseFloat(document.getElementById('dd-zone').value || '1.0');

    let base = 2500;
    if (items >= 4 && items <= 6) base = 3000;
    else if (items >= 7) base = 3000 + (items - 6) * 500;

    const baseWithZone = Math.round(base * zoneK);
    const storageDays = Math.max(0, days - 1);
    const storageCost = storageDays * 500;
    const total = baseWithZone + storageCost;

    const lines = [
      `База за ${items} ед.: ${base.toLocaleString('ru-RU')} ₽ × ${zoneK.toFixed(1)} = <b>${baseWithZone.toLocaleString('ru-RU')} ₽</b>`,
      `Хранение: 1-е сутки бесплатно + ${storageDays} × 500 ₽ = <b>${storageCost.toLocaleString('ru-RU')} ₽</b>`
    ];

    document.getElementById('dd-total').innerHTML = `${total.toLocaleString('ru-RU')} ₽`;
    document.getElementById('dd-lines').innerHTML = lines.join('<br>');
    document.getElementById('dd-result').hidden = false;
  }

  (function(){
    const airports = ["шереметьево","домодедово","внуково","жуковский","svo","dme","vko","zia"];
    const rail = ["белорусский","курский","ленинградский","киевский","казанский","павелецкий","рижский","савёловский","савеловский","ярославский","вокзал","ржд"];
    const moscowHints = ["москва","москве","мкад","цао","сао","свао","вао","ювао","юао","юзао","зао","сзао"];

    const input = document.getElementById('zoneAddress');
    const btn = document.getElementById('detectZone');
    const out = document.getElementById('zoneResult');
    const zoneSelect = document.getElementById('dd-zone');

    function decideZone(text){
      const q = (text||"").toLowerCase().trim();
      if (!q) return null;
      const isAirport = airports.some(a => q.includes(a));
      const isRail = rail.some(r => q.includes(r));
      const isMoscow = moscowHints.some(m => q.includes(m));
      if (isAirport || isRail || isMoscow) return {zone:"Зона 1", coef:"×1.0", pill:"pill--z1", val:"1.0"};
      return {zone:"Зона 1.5", coef:"×1.5", pill:"pill--z15", val:"1.5"};
    }

    btn.addEventListener('click', () => {
      const res = decideZone(input.value);
      if (!res){
        out.innerHTML = `<span class="pill pill--z15">Введите адрес</span>`;
        return;
      }
      out.innerHTML = `<span class="pill ${res.pill}">${res.zone}</span><span style="margin-left:8px;color:var(--muted,#64748b)">коэффициент ${res.coef}</span>`;
      if (zoneSelect) zoneSelect.value = res.val;
    });
  })();
</script>

<section class="faq max-w-3xl mx-auto px-4 py-8">
  <h2 class="text-3xl font-semibold mb-4">FAQ</h2>

  <button class="acc-trigger" aria-expanded="false" aria-controls="faq1" id="faq1-trigger">Что я получу при передаче багажа?</button>
  <div class="acc-panel" id="faq1" role="region" aria-labelledby="faq1-trigger">
    <p>Мы оформляем и выдаём <strong>Акт приёма-передачи</strong>: фиксируем состав мест, состояние, номера пломб, время и адреса. Возврат багажа осуществляется строго по этому акту.</p>
  </div>

  <button class="acc-trigger" aria-expanded="false" aria-controls="faq2" id="faq2-trigger">Как происходит оплата?</button>
  <div class="acc-panel" id="faq2" role="region" aria-labelledby="faq2-trigger">
    <p><strong>Только безналично и после возврата багажа.</strong> Доступны: QR-код СБП, платёжная ссылка, Tap to Phone. Наличную оплату не принимаем.</p>
  </div>

  <button class="acc-trigger" aria-expanded="false" aria-controls="faq3" id="faq3-trigger">Если я не смогу получить багаж лично?</button>
  <div class="acc-panel" id="faq3" role="region" aria-labelledby="faq3-trigger">
    <p>Мы <strong>организуем отправку</strong> удобным для вас способом и в удобное место (курьерская служба по РФ, ПВЗ, адресная доставка). Способ и возможные расходы согласуем заранее.</p>
  </div>

  <button class="acc-trigger" aria-expanded="false" aria-controls="faq4" id="faq4-trigger">Как проходит услуга по шагам?</button>
  <div class="acc-panel" id="faq4" role="region" aria-labelledby="faq4-trigger">
    <p>Заявка → подтверждение → приезд представителя → упаковка и пломбирование → оформление акта → хранение/доставка → встреча и проверка → безналичная оплата → выдача багажа.</p>
  </div>

  <button class="acc-trigger" aria-expanded="false" aria-controls="faq5" id="faq5-trigger">Где вы работаете?</button>
  <div class="acc-panel" id="faq5" role="region" aria-labelledby="faq5-trigger">
    <p>Москва и МКАД, аэропорты и вокзалы Москвы. По РФ — отправка через партнёрские службы по согласованию.</p>
  </div>

  <button class="acc-trigger" aria-expanded="false" aria-controls="faq6" id="faq6-trigger">Сроки и буфер времени</button>
  <div class="acc-panel" id="faq6" role="region" aria-labelledby="faq6-trigger">
    <p>Просим закладывать минимум <strong>90 минут</strong> буфера до вылёта/поезда для подачи и возврата багажа.</p>
  </div>

  <button class="acc-trigger" aria-expanded="false" aria-controls="faq7" id="faq7-trigger">Что нельзя передавать?</button>
  <div class="acc-panel" id="faq7" role="region" aria-labelledby="faq7-trigger">
    <p>Опасные вещества, оружие/боеприпасы, наркотические/ядовитые вещества, скоропорт, наличные деньги, драгоценности, документы и иные предметы, запрещённые законом или правилами перевозчиков.</p>
  </div>

  <button class="acc-trigger" aria-expanded="false" aria-controls="faq8" id="faq8-trigger">Как обеспечивается сохранность?</button>
  <div class="acc-panel" id="faq8" role="region" aria-labelledby="faq8-trigger">
    <p>Профессиональная упаковка, <strong>пломбирование</strong> с уникальным номером, фотофиксация. Номер пломбы указан в Акте.</p>
  </div>

  <button class="acc-trigger" aria-expanded="false" aria-controls="faq9" id="faq9-trigger">Можно ли изменить время или адрес?</button>
  <div class="acc-panel" id="faq9" role="region" aria-labelledby="faq9-trigger">
    <p>Да, при возможности расписания. Сообщите нам не позднее чем за 3 часа до выбранного слота.</p>
  </div>

  <button class="acc-trigger" aria-expanded="false" aria-controls="faq10" id="faq10-trigger">Если есть риск опоздания?</button>
  <div class="acc-panel" id="faq10" role="region" aria-labelledby="faq10-trigger">
    <p>Мы уведомим вас и предложим альтернативу: перенос, выдачу в другой точке или отправку багажной/курьерской службой. Решение согласуем с вами.</p>
  </div>

  <button class="acc-trigger" aria-expanded="false" aria-controls="faq11" id="faq11-trigger">Отмена и перенос</button>
  <div class="acc-panel" id="faq11" role="region" aria-labelledby="faq11-trigger">
    <p>Бесплатно за 12 часов до слота. При переносе менее чем за 12 часов может взиматься доплата за выезд.</p>
  </div>

  <button class="acc-trigger" aria-expanded="false" aria-controls="faq12" id="faq12-trigger">Что такое Акт приёма-передачи?</button>
  <div class="acc-panel" id="faq12" role="region" aria-labelledby="faq12-trigger">
    <p>Основной документ услуги: подтверждает передачу и возврат, содержит перечень мест, номера пломб и отметки о состоянии.</p>
  </div>

  <button class="acc-trigger" aria-expanded="false" aria-controls="faq13" id="faq13-trigger">Пломба или упаковка повреждены?</button>
  <div class="acc-panel" id="faq13" role="region" aria-labelledby="faq13-trigger">
    <p>При возврате вместе сверяем целостность пломб и упаковки, все отметки фиксируются в Акте.</p>
  </div>

  <button class="acc-trigger" aria-expanded="false" aria-controls="faq14" id="faq14-trigger">Как связаться с вами?</button>
  <div class="acc-panel" id="faq14" role="region" aria-labelledby="faq14-trigger">
    <p>Телефон, WhatsApp, Telegram, email — в разделе «Контакты».</p>
  </div>
</section>

<style>
  .faq .acc-trigger{width:100%;text-align:left;border:1px solid #e5e7eb;border-radius:16px;padding:16px 20px;margin-bottom:10px;background:#fff;font-size:18px;line-height:1.3;font-weight:600;display:flex;justify-content:space-between;align-items:center;transition:background .2s,border-color .2s}
  .faq .acc-trigger::after{content:"+";font-size:22px;line-height:1}
  .faq .acc-trigger[aria-expanded="true"]{background:#f8fafc;border-color:#cbd5e1}
  .faq .acc-trigger[aria-expanded="true"]::after{content:"–"}
  .faq .acc-panel{overflow:hidden;max-height:0;transition:max-height .25s ease;padding:0 4px;margin:-5px 0 10px 0}
  .faq .acc-panel p{padding:8px 4px 6px}
</style>

<script>
  (function(){
    const triggers=document.querySelectorAll('.acc-trigger');
    function closeAll(){triggers.forEach(b=>{b.setAttribute('aria-expanded','false');const p=b.nextElementSibling;p.style.maxHeight=null;});}
    triggers.forEach(btn=>{
      btn.addEventListener('click',()=>{
        const isOpen=btn.getAttribute('aria-expanded')==='true';
        closeAll();
        if(!isOpen){
          btn.setAttribute('aria-expanded','true');
          const panel=btn.nextElementSibling;
          panel.style.maxHeight=panel.scrollHeight+'px';
        }
      });
    });
  })();
</script>

<section class="card-dd p-4 p-md-5 mb-4 text-center">
  <h4 class="fw-bold mb-2">Гуляйте по Москве налегке</h4>
  <div class="text-muted mb-3">Багаж — на нас. Доставим точно ко времени рейса или заезда.</div>
  <a href="{% url 'order_create' %}" class="btn btn-lg btn-primary pill px-4"><i class="bi bi-bag"></i> Оставить заявку</a>
</section>
{% endblock %}
