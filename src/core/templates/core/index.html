{% extends "core/base.html" %}
{% load static %}

{% block title %}D&D — доставка и хранение багажа в Москве и области{% endblock %}

{% block extra_head %}
  <meta name="description" content="Заберём чемоданы у двери, опечатаем и сохраним, привезём ко времени — в аэропорт, на вокзал или по адресу в Москве и области. Прозрачные условия, пломбы, акт и аккуратная работа представителя.">
  <meta property="og:title" content="D&D — доставка и хранение багажа в Москве и области">
  <meta property="og:description" content="Забор, хранение и доставка багажа от двери до двери — ко времени и без лишних поездок.">
  <meta property="og:url" content="{{ SITE_URL }}{{ CANONICAL_PATH }}">
  <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'core/img/logo-512.png' %}">

  {# JSON-LD: HowTo — шаги #}
  <script type="application/ld+json">
  {
   "@context":"https://schema.org",
   "@type":"HowTo",
   "name":"Как оформить доставку и хранение багажа в Москве",
   "description":"Пошаговая инструкция: от заявки до доставки ко времени.",
   "step":[
    {"@type":"HowToStep","name":"Заявка","text":"Оставьте заявку на сайте или в мессенджере — согласуем адреса и время."},
    {"@type":"HowToStep","name":"Забор багажа","text":"Представитель приедет с документами и упаковкой, пломбирует и сфотографирует багаж."},
    {"@type":"HowToStep","name":"Хранение","text":"Мы храним багаж на складе с ограниченным доступом."},
    {"@type":"HowToStep","name":"Доставка","text":"Привозим в аэропорт, на вокзал или по адресу строго к вашему времени."},
    {"@type":"HowToStep","name":"Оплата","text":"Проверяете целостность — затем оплачиваете удобным способом."}
   ]
  }
  </script>

  {# JSON-LD: Service — без жёсткой завязки на одну страницу тарифов #}
  <script type="application/ld+json">
  {
   "@context":"https://schema.org",
   "@type":"Service",
   "name":"Доставка и хранение багажа — Москва и область",
   "serviceType":"Door-to-door luggage delivery & storage",
   "provider":{"@id":"https://www.drop-delivery.ru/#organization"},
   "areaServed":["Москва","Московская область"],
   "url":"{{ SITE_URL }}/",
   "offers":{
     "@type":"AggregateOffer",
     "priceCurrency":"RUB",
     "priceSpecification":[
       {"@type":"UnitPriceSpecification","name":"1–3 единицы","price":"3500","priceCurrency":"RUB"},
       {"@type":"UnitPriceSpecification","name":"4–6 единиц","price":"4000","priceCurrency":"RUB"},
       {"@type":"UnitPriceSpecification","name":"7+ единиц","price":"4500","priceCurrency":"RUB"}
     ],
     "url":"{{ SITE_URL }}#tariffs",
     "availability":"https://schema.org/InStock"
   }
  }
  </script>

  <style>
    :root{--ink:#0f172a;--muted:#64748b;--r:24px;}
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
    body{font-family:'Poppins',system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;}
    h1,h2,h3,h4{letter-spacing:-0.01em;}
    .pill{border-radius:999px}
    .card-dd{border:0;border-radius:var(--r);box-shadow:0 12px 30px rgba(16,24,40,.08);background:#fff;}
    .hero-wrap{
      border-radius:32px;
      box-shadow:0 20px 50px rgba(16,24,40,.06);
      background:#fff;
      padding:3rem 2rem;
      margin-bottom:3rem;
      display:grid;
      grid-template-columns:1.2fr .8fr;
      gap:32px;
      align-items:center;
    }
    .hero-left{max-width:720px;}
    .hero-title{
      font-weight:800;
      font-size:clamp(32px,3.8vw,48px);
      line-height:1.1;
      color:var(--ink);
      margin:0 0 14px;
    }
    .hero-title .accent{color:#0d6efd;}
    .hero-sub{
      font-size:1.05rem;
      color:var(--muted);
      margin:0 0 14px;
    }
    .hero-bullets{
      margin:0 0 16px;
      padding-left:18px;
      font-size:0.95rem;
      color:var(--ink);
    }
    .hero-actions{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:6px;}
    .hero-note{font-size:0.8rem;color:var(--muted);}
    .hero-ill{
      border-radius:24px;
      background:#fff;
      box-shadow:0 10px 26px rgba(16,24,40,.08);
      padding:1.25rem;
      text-align:center;
    }
    .hero-ill img{
      display:block;
      width:100%;
      max-width:420px;
      margin:0 auto;
      border-radius:16px;
    }
    .section-title{
      font-size:1.35rem;
      font-weight:700;
      margin-bottom:14px;
    }
    .muted{color:var(--muted);}
    .dd-chip{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid #d6e4ff;
      background:#ecf3ff;
      color:#1e3a8a;
      font-size:12px;
    }
    .dd-divider{height:1px;background:#eef2ff;margin:8px 0 10px;}
    .dd-calc .form-control,.dd-calc .form-select{
      border-radius:12px;
      padding:.8rem .9rem;
      border-color:#e5e7eb;
    }
    .dd-calc .form-control:focus,.dd-calc .form-select:focus{
      border-color:#2563eb;
      box-shadow:0 0 0 .35rem rgba(37,99,235,.15);
    }
    .dd-total{font-weight:800;font-size:1.6rem;color:var(--ink);}
    .services-links a{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 12px;
      margin:4px 6px 0 0;
      border-radius:999px;
      font-size:0.86rem;
      color:#111827;
      background:#eef2ff;
      text-decoration:none;
      border:1px solid #e5e7eb;
    }
    .services-links a i{font-size:0.9rem;color:#4f46e5;}
    @media (max-width: 992px){
      .hero-wrap{
        grid-template-columns:1fr;
        padding:2rem 1.5rem;
      }
    }
  </style>
{% endblock %}

{% block content %}

{# УПРОЩЁННЫЙ HERO: один H1, без слайдера #}
<section class="hero-wrap">
  <div class="hero-left">
    <p class="text-uppercase text-primary small fw-semibold mb-2">
      Забор, хранение и доставка багажа от двери до двери
    </p>
    <h1 class="hero-title">
      Доставка и хранение багажа в Москве и области — <span class="accent">путешествуйте налегке</span>
    </h1>
    <p class="hero-sub">
      Заберём чемоданы у двери, опечатаем и сохраним на складе, а затем доставим в аэропорт, на вокзал или по адресу
      <b>точно ко времени</b>. 1 сутки хранения включены, страхование до 30 000 ₽.
    </p>
    <ul class="hero-bullets">
      <li>Забор багажа из квартир, отелей, апартаментов и офисов.</li>
      <li>Опечатывание, фотофиксация и акт приёма-передачи.</li>
      <li>Доставка в Шереметьево, Домодедово, Внуково, Жуковский и по Москве.</li>
    </ul>
    <div class="hero-actions">
      <a href="{% url 'order_create' %}" class="btn btn-lg btn-primary px-4">
        <i class="bi bi-bag-check"></i> Оставить заявку
      </a>
      <a href="#tariffs" class="btn btn-lg btn-outline-primary px-4">
        <i class="bi bi-tags"></i> Тарифы
      </a>
      <a href="{% url 'benefits' %}" class="btn btn-lg btn-outline-primary px-4">
        Почему это безопасно
      </a>
    </div>
    <div class="hero-note">
      Ответим в WhatsApp и Telegram, поможем посчитать стоимость и подобрать удобное время забора и доставки.
    </div>
  </div>
  <div class="hero-ill">
    <img src="{% static 'core/img/dnd-hero.png' %}"
         alt="Drop & Delivery — забор, хранение и доставка багажа"
         loading="eager" fetchpriority="high" decoding="async">
    <div class="small text-muted mt-2">
      Каждый чемодан — с пломбой, актом и фотофиксацией.
    </div>
  </div>
</section>

{# КОРОТКО: КОГДА НУЖЕН СЕРВИС #}
<section class="mb-4">
  <h2 class="section-title">Когда удобен сервис Drop & Delivery</h2>
  <p class="muted mb-2">
    Ранний прилёт, поздний вылет, пересадка, смена отеля, деловая поездка или переезд — мы берём багаж на себя.
    Это альтернатива камерам хранения: без очередей, с выездом представителя и доставкой ко времени.
  </p>
</section>

{# ШАГИ — оставляем как есть, но без перегруза #}
<section class="p-4 p-md-5 mb-5" style="border-radius:28px;background:#f7fbff">
  <h2 class="fw-bold text-center mb-4">Как работает услуга доставки багажа</h2>
  <div class="row row-cols-2 row-cols-md-3 row-cols-xl-5 g-4 justify-content-center">
    <div class="col text-center">
      <div class="icon-wrap icon-blue mx-auto mb-3"><i class="bi bi-pencil-square fs-3"></i></div>
      <h6 class="mb-1">1. Заявка</h6>
      <div class="text-muted small">Оставляете на сайте или в мессенджере.</div>
    </div>
    <div class="col text-center">
      <div class="icon-wrap icon-green mx-auto mb-3"><i class="bi bi-person-check fs-3"></i></div>
      <h6 class="mb-1">2. Встреча</h6>
      <div class="text-muted small">Представитель приезжает с документами и упаковкой.</div>
    </div>
    <div class="col text-center">
      <div class="icon-wrap icon-cyan mx-auto mb-3"><i class="bi bi-lock fs-3"></i></div>
      <h6 class="mb-1">3. Опечатываем</h6>
      <div class="text-muted small">Пломбы с номерами, фотофиксация, акт.</div>
    </div>
    <div class="col text-center">
      <div class="icon-wrap icon-amber mx-auto mb-3"><i class="bi bi-geo-alt fs-3"></i></div>
      <h6 class="mb-1">4. Доставка</h6>
      <div class="text-muted small">В аэропорт, на вокзал или по адресу.</div>
    </div>
    <div class="col text-center">
      <div class="icon-wrap icon-blue mx-auto mb-3"><i class="bi bi-credit-card fs-3"></i></div>
      <h6 class="mb-1">5. Оплата</h6>
      <div class="text-muted small">После проверки целостности багажа.</div>
    </div>
  </div>
</section>

{# ТАРИФЫ — как было, это ядро, оставляем #}
<section id="tariffs" class="mb-5">
  <h2 class="fw-bold text-center mb-4">Тарифы на доставку багажа</h2>
  <div class="row g-4">
    <div class="col-md-4">
      <div class="card-dd p-4 h-100 text-center">
        <div class="small tariff-title mb-1">1–3 единицы</div>
        <div class="tariff-price mb-2">от 3 500 <span class="rub">₽</span></div>
        <div class="dd-divider"></div>
        <div class="text-muted small">Забор → хранение → доставка</div>
        <div class="mt-2"><span class="dd-chip">1 сутки хранения включены</span></div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card-dd p-4 h-100 text-center">
        <div class="small tariff-title mb-1">4–6 единиц</div>
        <div class="tariff-price mb-2">от 4 000 <span class="rub">₽</span></div>
        <div class="dd-divider"></div>
        <div class="text-muted small">Забор → хранение → доставка</div>
        <div class="mt-2"><span class="dd-chip">1 сутки хранения включены</span></div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card-dd p-4 h-100 text-center">
        <div class="small tariff-title mb-1">7+ единиц</div>
        <div class="tariff-price mb-2">4 500 <span class="rub">₽</span> + 500 ₽/за каждую доп. ед.</div>
        <div class="dd-divider"></div>
        <div class="text-muted small">Забор → хранение → доставка</div>
        <div class="mt-2"><span class="dd-chip">1 сутки хранения бесплатно</span></div>
      </div>
    </div>
  </div>
</section>

{# КАЛЬКУЛЯТОР — оставляем, но как доп. блок, не главный смысл #}
<section class="mb-5 mt-4 mt-lg-5">
  <div class="card-dd p-4 dd-calc">
    <h2 class="h5 mb-3">Калькулятор примерной стоимости</h2>
    <p class="muted small mb-2">
      Укажите количество единиц багажа, срок хранения и зону — получаете ориентировочную сумму.
      Точный расчёт закрепим при подтверждении заявки.
    </p>

    <form id="dd-calc-form" class="row gx-3 gy-3 align-items-end" novalidate>
      <div class="col-6 col-md-3">
        <label for="calcUnits" class="form-label">Единиц багажа</label>
        <input id="calcUnits" type="number" min="1" value="2" class="form-control" />
      </div>
      <div class="col-6 col-md-3">
        <label for="calcDays" class="form-label">Дней хранения</label>
        <input id="calcDays" type="number" min="1" value="1" class="form-control" />
      </div>
      <div class="col-12 col-md-4">
        <label for="calcZone" class="form-label">Зона</label>
        <select id="calcZone" class="form-select">
          <option value="1.0" selected>Зона 1 — Москва, все аэропорты и вокзалы (×1.0)</option>
          <option value="1.5">Зона 1.5 — Московская область (×1.5)</option>
        </select>
      </div>
      <div class="col-12 col-md-2 text-md-end">
        <button id="dd-calc-btn" type="button" class="btn btn-primary w-100 w-md-auto">
          <i class="bi bi-calculator me-1"></i> Рассчитать
        </button>
      </div>
    </form>

    <div id="dd-calc-result" class="alert alert-light border mt-3" role="status" aria-live="polite">
      <div class="dd-total">0 ₽</div>
      <div id="dd-calc-breakdown" class="text-secondary small mt-1"></div>
    </div>
  </div>
</section>

{# КРАТКИЙ SEO-ТЕКСТ — оставляем, он норм, не раздуваем #}
<section id="about-service" class="card-dd p-4 p-md-5 mb-5">
  <h2 class="h5 fw-bold mb-3">Доставка и хранение багажа в Москве — удобно и вовремя</h2>
  <p class="text-secondary mb-2">
    Сервис <b>Drop & Delivery</b> забирает чемоданы <b>от двери</b>, бережно <b>упаковывает и пломбирует</b>, хранит на складе
    и <b>доставляет ко времени</b> в аэропорт, на вокзал или по адресу. Это альтернатива классическим камерам хранения:
    без очередей, без лишних поездок и с чёткими условиями.
  </p>
  <p class="text-secondary mb-2">
    Подходит путешественникам с пересадкой, семьям с детьми, деловым гостям и тем, кто переезжает внутри города.
    Мы фиксируем номера пломб и состояние багажа в акте, отслеживаем рейсы и при необходимости корректируем время встречи.
    <b>Оплата — после проверки</b> целостности и комплектности.
  </p>
  <p class="text-secondary mb-0">
    Работаем по Москве и области, доставляем в Шереметьево, Домодедово, Внуково, Жуковский и по любым адресам.
    Для крупных заказов и сложных маршрутов предлагаем индивидуальные решения.
  </p>
</section>

{# FAQ-блок как тизер, полный — на отдельной странице #}
<section class="card-dd p-4 p-md-5 mb-4 text-center">
  <h2 class="h5 fw-bold mb-2">Ответы на частые вопросы</h2>
  <p class="text-muted mb-3">
    Как обеспечиваем сохранность, как оформляется акт, что нельзя сдавать, как считается стоимость — собрали всё в одном разделе.
  </p>
  <a href="{% url 'faq' %}" class="btn btn-outline-primary pill px-4">
    <i class="bi bi-question-circle"></i> Перейти в FAQ
  </a>
</section>

{# ПОПУЛЯРНЫЕ НАПРАВЛЕНИЯ — внутренняя перелинковка #}
<section class="card-dd p-4 mt-4 mb-4">
  <h2 class="h5 fw-bold mb-2">Популярные направления</h2>
  <div class="d-flex flex-wrap gap-2">
    <a class="btn btn-light border pill" href="{% url 'aero' 'svo' %}">Доставка в Шереметьево</a>
    <a class="btn btn-light border pill" href="{% url 'aero' 'dme' %}">Доставка в Домодедово</a>
    <a class="btn btn-light border pill" href="{% url 'aero' 'vko' %}">Доставка в Внуково</a>
    <a class="btn btn-light border pill" href="{% url 'aero' 'zia' %}">Доставка в Жуковский</a>
    <a class="btn btn-light border pill" href="{% url 'storage_moscow' %}">Хранение багажа в Москве</a>
  </div>
</section>

{# СМОТРИТЕ ТАКЖЕ — финальный блок ссылок #}
<section class="card-dd p-4 p-md-5 mb-5">
  <h2 class="h5 fw-bold mb-3">Смотрите также</h2>
  <div class="d-flex flex-wrap gap-2">
    <a class="btn btn-light border pill" href="{% url 'benefits' %}">Почему мы — от двери до двери</a>
    <a class="btn btn-light border pill" href="{% url 'faq' %}">FAQ: ответы на частые вопросы</a>
    <a class="btn btn-light border pill" href="{% url 'offer' %}">Публичная оферта</a>
    <a class="btn btn-light border pill" href="{% url 'contacts' %}">Контакты</a>
  </div>
</section>

{% endblock %}

{% block extra_scripts %}
  {# Только логика калькулятора, без Swiper #}
  <script>
    (function(){
      const form = document.getElementById('dd-calc-form');
      if (!form) return;

      const unitsEl = document.getElementById('calcUnits');
      const daysEl  = document.getElementById('calcDays');
      const zoneEl  = document.getElementById('calcZone');
      const btn     = document.getElementById('dd-calc-btn');

      const totalEl     = document.querySelector('#dd-calc-result .dd-total');
      const breakdownEl = document.getElementById('dd-calc-breakdown');

      const fmt = n => n.toLocaleString('ru-RU');

      function sanitizeInt(val, min) {
        const n = parseInt(val, 10);
        return (Number.isFinite(n) && n >= min) ? n : min;
      }

      function basePrice(units) {
        if (units <= 3) return 3500;
        if (units <= 6) return 4000;
        return 4500 + 500 * Math.max(0, units - 7);
      }

      function storageCost(days) {
        const extra = Math.max(0, days - 1);
        return 500 * extra;
      }

      function calculate() {
        const u = sanitizeInt(unitsEl.value, 1);
        const d = sanitizeInt(daysEl.value, 1);
        const k = parseFloat(zoneEl.value) || 1.0;

        unitsEl.value = u;
        daysEl.value  = d;

        const base = basePrice(u);
        const move = Math.round(base * k);
        const store = storageCost(d);
        const total = move + store;

        totalEl.textContent = fmt(total) + ' ₽';
        breakdownEl.textContent =
          `Доставка: ${fmt(base)} ₽ × коэффициент ${k} = ${fmt(move)} ₽. ` +
          `Хранение: ${fmt(store)} ₽ (${d > 1 ? (d-1) + ' доп. сут.' : '1-е сутки бесплатно'}).`;
      }

      btn.addEventListener('click', calculate);
      form.addEventListener('input', calculate);
      form.addEventListener('change', calculate);

      calculate();
    })();
  </script>
{% endblock %}
