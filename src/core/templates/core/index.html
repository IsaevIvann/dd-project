{% extends "core/base.html" %}
{% load static %}

{% block title %}D&D — доставка и хранение багажа в Москве и области{% endblock %}

{% block extra_head %}
  <meta name="description" content="Заберём чемоданы у двери, опечатаем и сохраним, привезём ко времени — в аэропорт, на вокзал или по адресу в Москве и области. Прозрачные условия и аккуратная работа представителя.">
  <meta property="og:title" content="D&D — доставка и хранение багажа в Москве и области">
  <meta property="og:description" content="Забор, хранение и доставка багажа от двери до двери — ко времени и без лишних поездок.">
  <meta property="og:url" content="{{ SITE_URL }}{{ CANONICAL_PATH }}">
  <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'core/img/logo-512.png' %}">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>

  <style>
    :root{--ink:#0f172a;--muted:#64748b;--r:24px;}
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
    body{font-family:'Poppins',system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;}
    h1,h2,h3,h4{letter-spacing:-0.01em;}
    .pill{border-radius:999px}
    .card-dd{border:0;border-radius:var(--r);box-shadow:0 12px 30px rgba(16,24,40,.08);background:#fff;}
    .hero-slider{border-radius:32px;box-shadow:0 20px 50px rgba(16,24,40,.06);background:#fff;overflow:hidden}
    .hero-slide{display:grid;grid-template-columns:1.15fr .85fr;gap:32px;padding:3.5rem 2rem;min-height:560px;position:relative}
    .hero-slide .left{display:flex;flex-direction:column;justify-content:center;max-width:720px}
    .hero-slide .right{display:flex;flex-direction:column;align-items:center;justify-content:center}
    .hero-ill{border-radius:24px;background:#fff;box-shadow:0 10px 26px rgba(16,24,40,.08);padding:1.25rem}
    .hero-ill img{display:block;width:100%;max-width:520px;aspect-ratio:4/3;object-fit:contain;border-radius:16px}
    .hero-title{font-weight:800;font-size:clamp(32px,3.8vw,48px);line-height:1.1;color:var(--ink);margin:0 0 12px}
    .hero-sub{font-size:1.125rem;color:var(--muted);margin:0 0 24px}
    .accent{color:#0d6efd}
    .hero-actions{display:flex;gap:12px;flex-wrap:wrap}
    .hero-caption{min-height:22px}
    .hero-swiper{overflow:hidden}
    .swiper-pagination{position:absolute;left:0;right:0;bottom:16px;z-index:3}
    .swiper-button-prev,.swiper-button-next{display:none!important}
    .swiper-pagination-bullet{opacity:.4;background:#1b2a4a}
    .swiper-pagination-bullet-active{opacity:1;background:#0d6efd}
    @media (max-width:992px){
      .hero-slide{grid-template-columns:1fr;padding:2rem;min-height:auto}
      .hero-title{font-size:clamp(26px,6vw,36px)}
    }

    /* калькулятор */
    .dd-chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid #d6e4ff;background:#ecf3ff;color:#1e3a8a;font-size:12px}
    .dd-divider{height:1px;background:#eef2ff;margin:8px 0 10px}
    .dd-calc .form-control,.dd-calc .form-select{border-radius:12px;padding:.8rem .9rem;border-color:#e5e7eb}
    .dd-calc .form-control:focus,.dd-calc .form-select:focus{border-color:#2563eb;box-shadow:0 0 0 .35rem rgba(37,99,235,.15)}
    .dd-total{font-weight:800;font-size:1.6rem;color:var(--ink)}
    .dd-muted{color:var(--muted)}
    @media (min-width: 768px){
      .w-md-auto{width:auto!important;}
    }
  </style>
{% endblock %}

{% block content %}
<!-- HERO -->
<section class="mb-5">
  <div class="swiper hero-swiper hero-slider">
    <div class="swiper-wrapper">
      <div class="swiper-slide">
        <article class="hero-slide">
          <div class="left">
            <h1 class="hero-title">Доставка багажа в Москве и области — путешествуйте <span class="accent">налегке</span></h1>
            <p class="hero-sub">Представитель приедет, упакует и заберет чемоданы. Мы сохраним их на складе и привезём <span class="fw-semibold">в удобное для вас место</span>: аэропорт, вокзал или отель — точно в срок.</p>
            <div class="hero-actions">
              <a href="{% url 'order_create' %}" class="btn btn-lg btn-primary px-4"><i class="bi bi-bag-check"></i> Оставить заявку</a>
              <a href="#tariffs" class="btn btn-lg btn-outline-primary px-4"><i class="bi bi-tags"></i> Тарифы</a>
            </div>
          </div>
          <div class="right">
            <div class="hero-ill text-center">
              <img src="{% static 'core/img/dnd-hero.png' %}" alt="Drop & Delivery — доставка багажа" class="img-fluid" loading="eager">
              <div class="small text-muted mt-2 hero-caption">Ваш багаж — под защитой ✈️</div>
            </div>
          </div>
        </article>
      </div>
    </div>
    <div class="swiper-pagination"></div>
  </div>
</section>

<!-- КАЛЬКУЛЯТОР -->
<section class="mb-5 mt-4 mt-lg-5">
  <div class="surface p-4 dd-calc">
    <h2 class="h4 mb-3">Калькулятор стоимости доставки багажа</h2>

    <form id="dd-calc-form" class="row gx-3 gy-3 align-items-end" novalidate>
      <div class="col-12 col-md-3 col-lg-2">
        <label for="calcUnits" class="form-label">Количество единиц</label>
        <input id="calcUnits" type="number" min="1" value="2" class="form-control" />
      </div>

      <div class="col-12 col-md-3 col-lg-2">
        <label for="calcDays" class="form-label">Дней хранения (включая 1-е)</label>
        <input id="calcDays" type="number" min="1" value="1" class="form-control" />
      </div>

      <div class="col-12 col-md-4 col-lg-4">
        <label for="calcZone" class="form-label">Зона</label>
        <select id="calcZone" class="form-select">
          <option value="1.0" selected>Зона 1 — Москва, все аэропорты (×1.0)</option>
          <option value="1.5">Зона 1.5 — Московская область (×1.5)</option>
        </select>
      </div>

      <div class="col-12 col-md-2 col-lg-4 text-md-end">
        <button id="dd-calc-btn" type="button" class="btn btn-primary w-100 w-md-auto">
          <i class="bi bi-calculator me-1"></i> Рассчитать
        </button>
      </div>
    </form>

    <div id="dd-calc-result" class="alert alert-light border mt-3" role="status" aria-live="polite">
      <div class="dd-total">0 ₽</div>
      <div id="dd-calc-breakdown" class="text-secondary small mt-1"></div>
    </div>

    <hr class="my-4">
    <div class="row gx-4 gy-3">
      <div class="col-md-6">
        <div class="fw-semibold small text-uppercase text-muted mb-1">Зона 1 (коэффициент: ×1.0)</div>
        <div class="h6 mb-1">Москва, все аэропорты и вокзалы</div>
      </div>
      <div class="col-md-6">
        <div class="fw-semibold small text-uppercase text-muted mb-1">Зона 1.5 (коэффициент: ×1.5)</div>
        <div class="h6 mb-1">Московская область</div>
      </div>
    </div>
  </div>
</section>

{% endblock %}

{% block extra_scripts %}
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    const hero = new Swiper('.hero-swiper', {
      loop:true,speed:650,effect:'fade',
      fadeEffect:{crossFade:true},
      autoplay:{delay:3000,disableOnInteraction:false},
      pagination:{el:'.swiper-pagination',clickable:true},
    });
  </script>

  <!-- D&D калькулятор -->
  <script>
    (function(){
      const form = document.getElementById('dd-calc-form');
      if (!form) return;

      const unitsEl = document.getElementById('calcUnits');
      const daysEl  = document.getElementById('calcDays');
      const zoneEl  = document.getElementById('calcZone');
      const btn     = document.getElementById('dd-calc-btn');
      const totalEl     = document.querySelector('#dd-calc-result .dd-total');
      const breakdownEl = document.getElementById('dd-calc-breakdown');

      const fmt = n => n.toLocaleString('ru-RU');

      function sanitizeInt(val, min) {
        const n = parseInt(val, 10);
        return (Number.isFinite(n) && n >= min) ? n : min;
      }

      function basePrice(units) {
        if (units <= 3) return 3500;
        if (units <= 6) return 4000;
        return 4500 + 500 * Math.max(0, units - 7);
      }

      function storageCost(days) {
        const extra = Math.max(0, days - 1);
        return 500 * extra;
      }

      function calculate() {
        const u = sanitizeInt(unitsEl.value, 1);
        const d = sanitizeInt(daysEl.value, 1);
        const k = parseFloat(zoneEl.value) || 1.0;

        unitsEl.value = u;
        daysEl.value  = d;

        const base = basePrice(u);
        const move = Math.round(base * k);
        const store = storageCost(d);
        const total = move + store;

        totalEl.textContent = fmt(total) + ' ₽';
        breakdownEl.textContent =
          `Доставка: ${fmt(base)} ₽ × коэффициент ${k} = ${fmt(move)} ₽. ` +
          `Хранение: ${fmt(store)} ₽ (${d > 1 ? (d-1) + ' доп. сут.' : '1-е сутки бесплатно'}).`;
      }

      btn.addEventListener('click', calculate);
      form.addEventListener('input', calculate);
      form.addEventListener('change', calculate);
      calculate();
    })();
  </script>
{% endblock %}
